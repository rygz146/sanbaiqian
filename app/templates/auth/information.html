{% extends '__include/base.html' %}

{% from 'macro/pagination.html' import render_pagination%}

{% block nav %}
    {% include '__include/nav.html' %}
{% endblock %}

{% block content %}

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class=flashes>
        {% for category, message in messages %}
          <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <div class="cards">
        <div class="card">
            <div class="card-header"><h5>{{ current_user.username }}</h5></div>
            <div class="card-body">
                <ul>
                    <li>{{ current_user.uniqueID }}</li>
                    {% for role in current_user.roles.all() %}
                    <li><a href="{{ url_for(role.name+'.index') }}">进入{{ role.name }}界面</a></li>
                    {% endfor %}
                </ul>
            </div>
            <div class="card-footer center text-center"><p>创建于 {{ current_user.create_time }}</p></div>
        </div>
    </div>

    <form action="{{ url_for('auth.upload') }}" method="post" enctype="multipart/form-data" >
        {{ form.hidden_tag() }}
        {{ form.files.lable }} {{ form.files(required='required', multiple="multiple") }}
        {% for error in form.files.errors %}
            <strong style="color: red">{{ error }}</strong><br>
        {% endfor %}
        {{ form.submit }}
    </form>

    <table class="table">
        <thead>
        <tr>
            <td></td>
            <td>文件</td>
            <td>大小</td>
            <td>创建时间</td>
            <td>操作</td>
        </tr>
        </thead>
        <tbody>
        {% for f in files %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ f.name }}</td>
                <td>{{ f.size }}</td>
                <td>{{ f.create_time }}</td>
                <td><a href="{{ url_for('auth.show', file_id=f.id) }}" target="_blank">预览</a> | <a href="{{ url_for('auth.download', file_id=f.id) }}">下载</a> | <a href="">删除</a></td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% if pagination %}
        {{ render_pagination(pagination, 'auth.information') }}
    {% endif %}

{% endblock %}